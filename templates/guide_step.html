<!doctype html>
<html lang="{{ lang }}">
<head>
  <meta charset="utf-8">
  <title>Step {{ current_step }}</title>
</head>
<body>
  <h1>Emergency Seizure Guide</h1>
  <h2>Step {{ current_step }}</h2>

  <img src="{{ url_for('static', filename='images/' + step.image) }}" width="300"><br>
  <p>{{ step.text[lang] }}</p>

  <audio id="audioPlayer" src="{{ url_for('static', filename='audio/' + audio_file) }}"
         {% if autoplay == "true" %} autoplay {% endif %}></audio>

  <button onclick="document.getElementById('audioPlayer').play()">üîä Play Audio</button>

  <div style="margin-top:20px;">
    {% if current_step > 1 %}
      <a href="{{ url_for('guide_step', step_num=current_step-1, lang=lang, autoplay=autoplay, handsfree=handsfree) }}">‚¨ÖÔ∏è Previous</a>
    {% endif %}
    {% if current_step < total_steps %}
      <a id="nextStep" href="{{ url_for('guide_step', step_num=current_step+1, lang=lang, autoplay=autoplay, handsfree=handsfree) }}" style="margin-left:20px;">Next ‚û°Ô∏è</a>
    {% endif %}

      <a href="{{ url_for('home') }}">
      <button>Back to Home</button>
      </a>

  </div>

  <br><br>
  <label><input type="checkbox" id="autoplayToggle" onchange="toggleSetting('autoplay')" {{ 'checked' if autoplay == 'true' else '' }}> Autoplay Audio</label>
  <br>
  <label><input type="checkbox" id="handsfreeToggle" onchange="toggleSetting('handsfree')" {{ 'checked' if handsfree == 'true' else '' }}> Hands-Free Auto Advance</label>

  <script>
    function toggleSetting(param) {
      const url = new URL(window.location.href);
      const checkbox = document.getElementById(param + "Toggle");
      url.searchParams.set(param, checkbox.checked);
      window.location.href = url.toString();
    }

    // Hands-free autoplay: auto-advance when audio ends
    const audio = document.getElementById("audioPlayer");
    {% if handsfree == "true" and current_step < total_steps %}
    audio.addEventListener("ended", () => {
      document.getElementById("nextStep").click();
    });
    {% endif %}
  </script>
</body>
</html>

