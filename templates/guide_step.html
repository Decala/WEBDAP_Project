<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Seizure Emergency Guide - Step {{ current_step }} of {{ total_steps }}</title>
</head>
<body>
    <h1>Step {{ current_step }} of {{ total_steps }}</h1>

    <!-- Step Image -->
    <img src="{{ url_for('static', filename='images/' + step.image) }}" alt="Step {{ current_step }} Image" style="max-width: 100%; height: auto;" />

    <!-- Step Text in selected language -->
    <p>{{ step.text.get(lang, step.text['en']) }}</p>

    <!-- Audio playback -->
    <audio id="stepAudio" controls preload="auto">
        <source src="{{ url_for('static', filename='audio/' + audio_file) }}" type="audio/mpeg" />
        Your browser does not support the audio element.
    </audio>

    <!-- Autoplay audio if autoplay param is true -->
    <script>
        const autoplay = "{{ autoplay|lower }}" === "true";
        if (autoplay) {
            const audio = document.getElementById('stepAudio');
            audio.play().catch(e => console.log("Autoplay prevented:", e));
        }
    </script>

    <!-- Navigation buttons -->
    <div style="margin-top: 20px;">
        {% if prev_step %}
            <a href="{{ url_for('guide_step', step_num=prev_step, lang=lang, autoplay=autoplay, handsfree=handsfree) }}">&#8592; Previous Step</a>
        {% else %}
            <span style="color: grey;">&#8592; Previous Step</span>
        {% endif %}

        &nbsp;|&nbsp;

        {% if next_step %}
            <a href="{{ url_for('guide_step', step_num=next_step, lang=lang, autoplay=autoplay, handsfree=handsfree) }}">Next Step &#8594;</a>
        {% else %}
            <span style="color: grey;">Next Step &#8594;</span>
        {% endif %}
    </div>

    <!-- Link back to guide start or home -->
    <div style="margin-top: 20px;">
        <a href="{{ url_for('start_guide', lang=lang, autoplay=autoplay, handsfree=handsfree) }}">Restart Guide</a> |
        <a href="{{ url_for('home') }}">Home</a>
    </div>
</body>
</html>
